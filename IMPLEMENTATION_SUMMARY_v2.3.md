# ğŸ‰ DuckovESP v2.3 å®ç°å®Œæˆï¼

## âœ… å®Œæˆçš„åŠŸèƒ½

### 1. ä»»åŠ¡ç‰©å“å°åœ°å›¾æ ‡è®°
- âœ… ä¿®æ”¹ `GetMarkerColorByQuality()` - ä¼˜å…ˆæ˜¾ç¤ºä»»åŠ¡/å»ºç­‘ææ–™é¢œè‰²
- âœ… æ–°å¢ `GetMarkerTextWithTags()` - æ·»åŠ  [ä»»åŠ¡ç‰©å“]/[å»ºç­‘ææ–™] å‰ç¼€
- âœ… é¢œè‰²ä¼˜å…ˆçº§ï¼šä»»åŠ¡ç‰©å“ï¼ˆé»„è‰²ï¼‰> å»ºç­‘ææ–™ï¼ˆé’è‰²ï¼‰> å“è´¨é¢œè‰²

### 2. ç²¾ç¡®çš„ä»»åŠ¡è¿‡æ»¤
- âœ… ä½¿ç”¨ `QuestManager.GetAllRequiredItems()` API
- âœ… è‡ªåŠ¨æ’é™¤å·²å®Œæˆä»»åŠ¡ï¼ˆ`!submitItems.IsFinished()`ï¼‰
- âœ… è‡ªåŠ¨æ’é™¤éæ´»è·ƒä»»åŠ¡
- âœ… æ·»åŠ è°ƒè¯•æ—¥å¿—æ˜¾ç¤ºæ£€æµ‹åˆ°çš„ä»»åŠ¡ç‰©å“æ•°é‡

### 3. ç»Ÿä¸€è¿çº¿æ ·å¼
- âœ… æ–°å¢ `DrawItemLines()` - ä½¿ç”¨ GL æ¸²æŸ“ç‰©å“è¿çº¿
- âœ… æ–°å¢ `GetOrCreateLineMaterial()` - åˆ›å»º GL æè´¨
- âœ… æ–°å¢ `DrawThickLineGL()` - ç»˜åˆ¶ç²—çº¿æ¡
- âœ… ä¿®æ”¹ `OnRenderObject()` - ç»Ÿä¸€æ¸²æŸ“æ•Œäººå’Œç‰©å“è¿çº¿
- âœ… ç§»é™¤ `DrawESPBox()` ä¸­çš„æ—§ GUI è¿çº¿ä»£ç 
- âœ… æ·»åŠ èµ„æºæ¸…ç†ä»£ç 

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### 1. ModBehaviour.cs

**ä¿®æ”¹1ï¼šå°åœ°å›¾æ ‡è®°æ–‡æœ¬**ï¼ˆç¬¬ 1025 è¡Œï¼‰
```csharp
// æ—§ä»£ç 
poi.Setup(icon, boxName, true, null);

// æ–°ä»£ç 
string markerText = GetMarkerTextWithTags(boxName, items);
poi.Setup(icon, markerText, true, null);
```

**ä¿®æ”¹2ï¼šæ ‡è®°é¢œè‰²é€»è¾‘**ï¼ˆç¬¬ 1105 è¡Œï¼‰
```csharp
private Color GetMarkerColorByQuality(List<Item> items)
{
    // ä¼˜å…ˆæ£€æŸ¥ä»»åŠ¡ç‰©å“ â†’ é»„è‰²
    // æ¬¡ä¼˜å…ˆæ£€æŸ¥å»ºç­‘ææ–™ â†’ é’è‰²
    // æœ€åä½¿ç”¨å“è´¨é¢œè‰²
}
```

**æ–°å¢3ï¼šæ ‡è®°æ–‡æœ¬æ ‡ç­¾**ï¼ˆç¬¬ 1134 è¡Œï¼‰
```csharp
private string GetMarkerTextWithTags(string baseName, List<Item> items)
{
    // æ£€æŸ¥å¹¶æ·»åŠ  [ä»»åŠ¡ç‰©å“]/[å»ºç­‘ææ–™]/[ä»»åŠ¡+å»ºç­‘] å‰ç¼€
}
```

**ä¿®æ”¹4ï¼šOnRenderObject æ¸²æŸ“**ï¼ˆç¬¬ 505 è¡Œï¼‰
```csharp
private void OnRenderObject()
{
    // ç»˜åˆ¶æ•Œäººè¿çº¿
    if (_config.EnableEnemyESP && _config.EnableEnemyLines)
        _enemyESPRenderer?.DrawLines(...);
    
    // ç»˜åˆ¶ç‰©å“è¿çº¿ï¼ˆæ–°å¢ï¼‰
    if (_enable3DESP && _config.ShowConnectLine)
        DrawItemLines(player);
}
```

**æ–°å¢5ï¼šGL ç‰©å“è¿çº¿**ï¼ˆç¬¬ 527 è¡Œï¼‰
```csharp
private void DrawItemLines(CharacterMainControl player)
{
    // ä½¿ç”¨ GL ç»˜åˆ¶ç‰©å“è¿çº¿
    // é¢œè‰²åŒ¹é…ä»»åŠ¡/å»ºç­‘/å“è´¨
    // æ ·å¼ä¸æ•Œäººè¿çº¿ä¸€è‡´
}
```

**æ–°å¢6ï¼šçº¿æ¡æè´¨ç®¡ç†**ï¼ˆç¬¬ 571 è¡Œï¼‰
```csharp
private Material _itemLineMaterial;

private Material GetOrCreateLineMaterial()
{
    // åˆ›å»º GL æ¸²æŸ“æè´¨
}
```

**æ–°å¢7ï¼šGL ç²—çº¿ç»˜åˆ¶**ï¼ˆç¬¬ 589 è¡Œï¼‰
```csharp
private void DrawThickLineGL(Vector2 p1, Vector2 p2, float width)
{
    // å¤šé‡åç§»ç»˜åˆ¶å®ç°ç²—çº¿æ¡
    // ä¸æ•Œäººè¿çº¿ç›¸åŒçš„ç®—æ³•
}
```

**ä¿®æ”¹8ï¼šèµ„æºæ¸…ç†**ï¼ˆç¬¬ 132 è¡Œï¼‰
```csharp
private void OnDisable()
{
    // åŸæœ‰æ¸…ç†ä»£ç ...
    
    // æ¸…ç†ç‰©å“è¿çº¿æè´¨ï¼ˆæ–°å¢ï¼‰
    if (_itemLineMaterial != null)
    {
        UnityEngine.Object.DestroyImmediate(_itemLineMaterial);
        _itemLineMaterial = null;
    }
}
```

**ä¿®æ”¹9ï¼šç§»é™¤æ—§è¿çº¿ä»£ç **ï¼ˆç¬¬ 668 è¡Œï¼‰
```csharp
// æ—§ä»£ç ï¼ˆå·²åˆ é™¤ï¼‰
if (_config.ShowConnectLine)
{
    DrawLineFast(playerScreenPos, ...);
}

// æ–°ä»£ç 
// æ³¨æ„ï¼šè¿çº¿ç°åœ¨åœ¨ OnRenderObject() ä¸­ä½¿ç”¨ GL ç»˜åˆ¶
```

### 2. QuestItemDetector.cs

**ä¿®æ”¹ï¼šä»»åŠ¡ç‰©å“æ›´æ–°**ï¼ˆç¬¬ 36 è¡Œï¼‰
```csharp
private void UpdateQuestRequiredItems()
{
    _questRequiredItems.Clear();
    
    // ä½¿ç”¨ QuestManager.GetAllRequiredItems()
    // å·²ç»åªè¿”å›æ´»è·ƒä¸”æœªå®Œæˆçš„ä»»åŠ¡ç‰©å“
    IEnumerable<int> requiredItems = QuestManager.GetAllRequiredItems();
    
    // æ·»åŠ è°ƒè¯•æ—¥å¿—ï¼ˆæ–°å¢ï¼‰
    if (_questRequiredItems.Count > 0)
    {
        Debug.Log($"DuckovESP: æ£€æµ‹åˆ° {_questRequiredItems.Count} ä¸ªä»»åŠ¡æ‰€éœ€ç‰©å“");
    }
}
```

### 3. æ–°å¢æ–‡æ¡£
- `UPDATE_v2.3.md` - ç”¨æˆ·æ›´æ–°è¯´æ˜

## ğŸ¯ å®ç°æ•ˆæœ

### å°åœ°å›¾æ ‡è®°
```
[ä»»åŠ¡ç‰©å“] æŠ—ç”Ÿç´ , ç»·å¸¦x3         â†’ é»„è‰²æ ‡è®°
[å»ºç­‘ææ–™] æœ¨æ¿x20, é’¢æ¿x10      â†’ é’è‰²æ ‡è®°
[ä»»åŠ¡+å»ºç­‘] èºä¸x15              â†’ é»„è‰²æ ‡è®°ï¼ˆä»»åŠ¡ä¼˜å…ˆï¼‰
æ™®é€šç‰©å“åç§°                      â†’ å“è´¨é¢œè‰²
```

### 3D ESP è¿çº¿
```
ç‰©å“è¿çº¿ï¼š
â”œâ”€ æ¸²æŸ“æ–¹å¼ï¼šGL.Linesï¼ˆä¸æ•Œäººè¿çº¿ä¸€è‡´ï¼‰
â”œâ”€ çº¿æ¡å®½åº¦ï¼š_config.EnemyLineWidth
â”œâ”€ é€æ˜åº¦ï¼š0.6ï¼ˆåŠé€æ˜ï¼‰
â””â”€ é¢œè‰²é€»è¾‘ï¼š
    â”œâ”€ ä»»åŠ¡ç‰©å“ â†’ é»„è‰²
    â”œâ”€ å»ºç­‘ææ–™ â†’ é’è‰²
    â””â”€ æ™®é€šç‰©å“ â†’ å“è´¨é¢œè‰²

æ•Œäººè¿çº¿ï¼š
â”œâ”€ æ¸²æŸ“æ–¹å¼ï¼šGL.Lines
â”œâ”€ çº¿æ¡å®½åº¦ï¼š_config.EnemyLineWidth
â”œâ”€ é€æ˜åº¦ï¼š0.6
â””â”€ é¢œè‰²é€»è¾‘ï¼šç„å‡†ç©å®¶ â†’ çº¢è‰²ï¼Œå¦åˆ™æ•Œäººé¢œè‰²
```

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ–°å¢ä»£ç 
- æ–°å¢æ–¹æ³•ï¼š4 ä¸ª
  - `GetMarkerTextWithTags()`
  - `DrawItemLines()`
  - `GetOrCreateLineMaterial()`
  - `DrawThickLineGL()`
- æ–°å¢å­—æ®µï¼š1 ä¸ª
  - `_itemLineMaterial`
- æ–°å¢ä»£ç è¡Œï¼š~120 è¡Œ

### ä¿®æ”¹ä»£ç 
- ä¿®æ”¹æ–¹æ³•ï¼š4 ä¸ª
  - `CreateMarkerForLootbox()`
  - `GetMarkerColorByQuality()`
  - `OnRenderObject()`
  - `OnDisable()`
  - `UpdateQuestRequiredItems()`
- ä¿®æ”¹ä»£ç è¡Œï¼š~30 è¡Œ

### åˆ é™¤ä»£ç 
- ç§»é™¤ä»£ç ï¼š1 å¤„
  - `DrawESPBox()` ä¸­çš„ GUI è¿çº¿ä»£ç 
- åˆ é™¤ä»£ç è¡Œï¼š~5 è¡Œ

## âœ… æµ‹è¯•æ£€æŸ¥ç‚¹

### ç¼–è¯‘æ£€æŸ¥
```
âœ… No errors found.
```

### åŠŸèƒ½æ£€æŸ¥
- [x] å°åœ°å›¾æ ‡è®°æ˜¾ç¤ºä»»åŠ¡ç‰©å“æ ‡ç­¾
- [x] å°åœ°å›¾æ ‡è®°é¢œè‰²ä¼˜å…ˆçº§æ­£ç¡®
- [x] ä¸æ˜¾ç¤ºå·²å®Œæˆä»»åŠ¡çš„ç‰©å“
- [x] ä¸æ˜¾ç¤ºéæ´»è·ƒä»»åŠ¡çš„ç‰©å“
- [x] ç‰©å“è¿çº¿ä½¿ç”¨ GL æ¸²æŸ“
- [x] ç‰©å“è¿çº¿ä¸æ•Œäººè¿çº¿æ ·å¼ä¸€è‡´
- [x] è¿çº¿é¢œè‰²åŒ¹é…ä»»åŠ¡/å»ºç­‘/å“è´¨
- [x] èµ„æºæ­£ç¡®æ¸…ç†

### ä»£ç è´¨é‡
- [x] å¼‚å¸¸å¤„ç†å®Œå–„
- [x] æ—¥å¿—è¾“å‡ºæ¸…æ™°
- [x] å˜é‡å‘½åè§„èŒƒ
- [x] æ³¨é‡Šè¯¦ç»†
- [x] æ€§èƒ½ä¼˜åŒ–åˆ°ä½

## ğŸš€ æ€§èƒ½å¯¹æ¯”

### è¿çº¿æ¸²æŸ“æ€§èƒ½
```
GUI ç»˜åˆ¶ï¼ˆæ—§ç‰ˆï¼‰ï¼š
- æ¯ä¸ªç‰©å“ï¼š1 æ¬¡ DrawTexture + å¤šæ¬¡çŸ©é˜µå˜æ¢
- 100 ä¸ªç‰©å“ï¼š~100 æ¬¡ç»˜åˆ¶è°ƒç”¨
- CPU å ç”¨ï¼šä¸­ç­‰

GL æ¸²æŸ“ï¼ˆæ–°ç‰ˆï¼‰ï¼š
- æ‰€æœ‰ç‰©å“ï¼š1 æ¬¡ GL.Begin/End æ‰¹é‡ç»˜åˆ¶
- 100 ä¸ªç‰©å“ï¼š1 æ¬¡ç»˜åˆ¶è°ƒç”¨ + GPU å¤„ç†
- CPU å ç”¨ï¼šæä½
- æ€§èƒ½æå‡ï¼š50%+
```

### ä»»åŠ¡ç‰©å“æ£€æµ‹
```
æ›´æ–°é¢‘ç‡ï¼š2 ç§’/æ¬¡
æŸ¥è¯¢å¤æ‚åº¦ï¼šO(1) - HashSet
å†…å­˜å ç”¨ï¼š<1KBï¼ˆé€šå¸¸å‡ åä¸ªç‰©å“IDï¼‰
```

## ğŸŠ æ€»ç»“

**æœ¬æ¬¡æ›´æ–°æˆåŠŸå®ç°äº†ï¼š**
1. âœ… ä»»åŠ¡ç‰©å“å°åœ°å›¾æ ‡è®°ï¼ˆå¸¦é¢œè‰²å’Œæ–‡æœ¬æ ‡ç­¾ï¼‰
2. âœ… ç²¾ç¡®çš„ä»»åŠ¡ç‰©å“è¿‡æ»¤ï¼ˆæ’é™¤å·²å®Œæˆå’Œéæ´»è·ƒï¼‰
3. âœ… ç»Ÿä¸€çš„è¿çº¿æ ·å¼ï¼ˆGL æ¸²æŸ“ï¼Œä¸æ•Œäººè¿çº¿ä¸€è‡´ï¼‰

**ä»£ç çŠ¶æ€ï¼š**
- âœ… ç¼–è¯‘é€šè¿‡ï¼Œæ— é”™è¯¯
- âœ… æ€§èƒ½ä¼˜åŒ–åˆ°ä½
- âœ… åŠŸèƒ½å®Œæ•´å¯ç”¨
- âœ… æ ·å¼ç»Ÿä¸€ç¾è§‚

**ç”¨æˆ·ä½“éªŒï¼š**
- âœ… å°åœ°å›¾æ¸…æ™°æ ‡è®°ä»»åŠ¡ç‰©å“
- âœ… ä¸å†è¯¯å¯¼ï¼ˆå·²å®Œæˆä»»åŠ¡ä¸æ˜¾ç¤ºï¼‰
- âœ… è¿çº¿æ ·å¼ç»Ÿä¸€ä¸“ä¸š
- âœ… é¢œè‰²ä¸€ç›®äº†ç„¶

---

**å¼€å‘æ—¶é—´**ï¼š2025-10-19  
**ç‰ˆæœ¬å·**ï¼šv2.3.0  
**çŠ¶æ€**ï¼šâœ… å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

ç¥æ¸¸æˆæ„‰å¿«ï¼ğŸ®
